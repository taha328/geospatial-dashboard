<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>
        <i class="fas fa-chart-line"></i>
        Tableau de Bord Intégré
      </h1>
      <p>Vue d'ensemble des actifs portuaires et anomalies signalées</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="refreshDashboard()">
        <i class="fas fa-sync-alt"></i>
        Actualiser
      </button>
      <a routerLink="/map" class="btn btn-secondary">
        <i class="fas fa-map"></i>
        Voir la Carte
      </a>
      <a routerLink="/assets" class="btn btn-secondary">
        <i class="fas fa-cogs"></i>
        Gestion Actifs
      </a>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Chargement du tableau de bord...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <i class="fas fa-exclamation-triangle"></i>
    <h3>Erreur de chargement</h3>
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="refreshDashboard()">
      <i class="fas fa-redo"></i>
      Réessayer
    </button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="carteDashboard && gestinoactifsStats && !loading" class="dashboard-content">
    
    <!-- KPI Cards -->
    <div class="kpi-section">
      <div class="section-header">
        <h2>
          <i class="fas fa-tachometer-alt"></i>
          Indicateurs Clés de Performance
        </h2>
      </div>
      
      <div class="kpi-grid">
        <!-- Total Actifs -->
        <div class="kpi-card primary">
          <div class="kpi-icon">
            <i class="fas fa-cogs"></i>
          </div>
          <div class="kpi-content">
            <div class="kpi-number">{{ carteDashboard.statistiques.actifs.total }}</div>
            <div class="kpi-label">Total Actifs</div>
            <div class="kpi-sublabel">Géolocalisés</div>
          </div>
        </div>

        <!-- Actifs Opérationnels -->
        <div class="kpi-card success">
          <div class="kpi-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="kpi-content">
            <div class="kpi-number">{{ carteDashboard.statistiques.actifs.parStatut?.operationnel || 0 }}</div>
            <div class="kpi-label">Opérationnels</div>
            <div class="kpi-sublabel">En service</div>
          </div>
        </div>

        <!-- Anomalies Signalées -->
        <div class="kpi-card warning">
          <div class="kpi-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="kpi-content">
            <div class="kpi-number">{{ carteDashboard.statistiques.anomalies.total }}</div>
            <div class="kpi-label">Anomalies</div>
            <div class="kpi-sublabel">Signalées</div>
          </div>
        </div>

        <!-- Anomalies Critiques -->
        <div class="kpi-card danger">
          <div class="kpi-icon">
            <i class="fas fa-exclamation-circle"></i>
          </div>
          <div class="kpi-content">
            <div class="kpi-number">{{ carteDashboard.statistiques.anomalies.parPriorite?.critique || 0 }}</div>
            <div class="kpi-label">Critiques</div>
            <div class="kpi-sublabel">Priorité haute</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="row">
        <!-- Répartition des Actifs par Statut -->
        <div class="col-md-6">
          <div class="chart-card">
            <div class="chart-header">
              <h3>
                <i class="fas fa-pie-chart"></i>
                Répartition des Actifs par Statut
              </h3>
            </div>
            <div class="chart-content">
              <div class="status-distribution">
                <div *ngFor="let statut of getObjectKeys(carteDashboard.statistiques.actifs.parStatut)" 
                     class="status-item">
                  <div class="status-indicator" 
                       [style.background-color]="getStatutColor(statut)"></div>
                  <span class="status-label">{{ statut }}</span>
                  <span class="status-count">{{ carteDashboard.statistiques.actifs.parStatut[statut] }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Répartition des Anomalies par Priorité -->
        <div class="col-md-6">
          <div class="chart-card">
            <div class="chart-header">
              <h3>
                <i class="fas fa-exclamation-triangle"></i>
                Anomalies par Priorité
              </h3>
            </div>
            <div class="chart-content">
              <div class="priority-distribution">
                <div *ngFor="let priorite of getObjectKeys(carteDashboard.statistiques.anomalies.parPriorite)" 
                     class="priority-item">
                  <div class="priority-indicator" 
                       [style.background-color]="getPrioriteColor(priorite)"></div>
                  <span class="priority-label">{{ priorite }}</span>
                  <span class="priority-count">{{ carteDashboard.statistiques.anomalies.parPriorite[priorite] }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Famille d'Actifs -->
      <div class="row">
        <div class="col-12">
          <div class="chart-card">
            <div class="chart-header">
              <h3>
                <i class="fas fa-layer-group"></i>
                Répartition par Famille d'Actifs
              </h3>
            </div>
            <div class="chart-content">
              <div class="famille-distribution">
                <div *ngFor="let famille of getObjectKeys(carteDashboard.statistiques.actifs.parFamille)" 
                     class="famille-item">
                  <div class="famille-header">
                    <span class="famille-name">{{ famille }}</span>
                    <span class="famille-count">{{ carteDashboard.statistiques.actifs.parFamille[famille] }} actifs</span>
                  </div>
                  <div class="famille-bar">
                    <div class="famille-progress" 
                         [style.width.%]="(carteDashboard.statistiques.actifs.parFamille[famille] / carteDashboard.statistiques.actifs.total) * 100">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions Section -->
    <div class="actions-section">
      <div class="section-header">
        <h2>
          <i class="fas fa-tools"></i>
          Actions Rapides
        </h2>
      </div>
      
      <div class="actions-grid">
        <a routerLink="/map" class="action-card">
          <div class="action-icon">
            <i class="fas fa-map-marked-alt"></i>
          </div>
          <div class="action-content">
            <h4>Signaler une Anomalie</h4>
            <p>Utiliser la carte interactive pour signaler des problèmes</p>
          </div>
        </a>

        <a routerLink="/assets" class="action-card">
          <div class="action-icon">
            <i class="fas fa-cogs"></i>
          </div>
          <div class="action-content">
            <h4>Gérer les Actifs</h4>
            <p>Consulter et modifier les actifs portuaires</p>
          </div>
        </a>

        <a routerLink="/assets" class="action-card">
          <div class="action-icon">
            <i class="fas fa-wrench"></i>
          </div>
          <div class="action-content">
            <h4>Planifier Maintenance</h4>
            <p>Programmer les interventions de maintenance</p>
          </div>
        </a>

        <a routerLink="/assets" class="action-card">
          <div class="action-icon">
            <i class="fas fa-chart-bar"></i>
          </div>
          <div class="action-content">
            <h4>Rapports Détaillés</h4>
            <p>Générer des rapports d'analyse</p>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>
