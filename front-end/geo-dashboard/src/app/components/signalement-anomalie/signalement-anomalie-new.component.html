<div class="form-container">
  <!-- Header Section -->
  <div class="form-header">
    <h2 class="form-title">
      <span class="section-icon">‚ö†Ô∏è</span>
      Signalement d'Anomalie
    </h2>
    <p class="form-subtitle">
      D√©clarer une anomalie pour une intervention rapide et efficace
    </p>
  </div>

  <!-- Success Alert -->
  <div *ngIf="showSuccess" class="alert alert-success">
    <i class="fas fa-check-circle me-2"></i>
    <strong>Succ√®s!</strong> Anomalie signal√©e avec succ√®s ! Elle sera prise en compte dans les meilleurs d√©lais.
  </div>

  <!-- Error Alert -->
  <div *ngIf="errorMessage" class="alert alert-danger">
    <i class="fas fa-exclamation-circle me-2"></i>
    <strong>Erreur:</strong> {{ errorMessage }}
  </div>

  <form [formGroup]="signalementForm" (ngSubmit)="onSubmit()">
    
    <!-- Basic Information Section -->
    <div class="form-section">
      <div class="section-title">
        <span class="section-icon">üìã</span>
        Informations G√©n√©rales
      </div>
      <div class="section-description">
        Identifiez l'anomalie et l'actif concern√©
      </div>
      
      <div class="form-group required">
        <label for="titre" class="form-label">
          <span class="label-icon">üè∑Ô∏è</span>
          Titre de l'Anomalie
        </label>
        <input 
          type="text" 
          id="titre"
          class="form-control"
          [class.is-invalid]="isFieldInvalid('titre')"
          [class.is-valid]="signalementForm.get('titre')?.valid && signalementForm.get('titre')?.touched"
          formControlName="titre"
          placeholder="Ex: D√©fense endommag√©e sur quai C1">
        <div *ngIf="isFieldInvalid('titre')" class="invalid-feedback">
          {{ getFieldErrorMessage('titre') }}
        </div>
        <div class="form-text">
          <i class="fas fa-lightbulb icon"></i>
          Utilisez un titre court et descriptif pour identifier rapidement l'anomalie
        </div>
      </div>

      <div class="form-group required">
        <label for="actifId" class="form-label">
          <span class="label-icon">üè≠</span>
          Actif Concern√©
        </label>
        
        <!-- Loading state -->
        <div *ngIf="isLoadingActifs" class="loading-overlay">
          <div class="spinner-border spinner-border-sm me-2"></div>
          <span>Chargement des actifs...</span>
        </div>
        
        <select 
          id="actifId"
          class="form-select"
          [class.is-invalid]="isFieldInvalid('actifId')"
          [class.is-valid]="signalementForm.get('actifId')?.valid && signalementForm.get('actifId')?.touched"
          formControlName="actifId">
          <option value="" disabled>S√©lectionner un actif</option>
          <option 
            *ngFor="let actif of allActifs" 
            [value]="actif.id"
            [title]="actif.description || actif.nom">
            {{ actif.nom }} ({{ actif.code }}) - {{ actif.type }}
          </option>
          <option value="" disabled *ngIf="allActifs.length === 0">
            Aucun actif disponible
          </option>
        </select>
        
        <div *ngIf="isFieldInvalid('actifId')" class="invalid-feedback">
          {{ getFieldErrorMessage('actifId') }}
        </div>
        
        <div class="form-text">
          <i class="fas fa-database icon"></i>
          {{ allActifs.length > 0 ? allActifs.length + ' actif(s) disponible(s)' : 'Chargement des actifs...' }}
        </div>
        
        <!-- Selected Asset Display -->
        <div *ngIf="getSelectedActifDisplay()" class="alert alert-info mt-3">
          <i class="fas fa-check me-2"></i>
          <strong>S√©lectionn√©:</strong> {{ getSelectedActifDisplay() }}
        </div>
      </div>
    </div>

    <!-- Description Section -->
    <div class="form-section">
      <div class="section-title">
        <span class="section-icon">üìù</span>
        Description D√©taill√©e
      </div>
      <div class="section-description">
        D√©crivez pr√©cis√©ment l'anomalie observ√©e
      </div>
      
      <div class="form-group required">
        <label for="description" class="form-label">
          <span class="label-icon">üìÑ</span>
          Description de l'Anomalie
        </label>
        <textarea 
          id="description"
          class="form-control"
          [class.is-invalid]="isFieldInvalid('description')"
          [class.is-valid]="signalementForm.get('description')?.valid && signalementForm.get('description')?.touched"
          formControlName="description"
          rows="5"
          placeholder="D√©crivez en d√©tail:
‚Ä¢ L'anomalie observ√©e sur l'actif
‚Ä¢ Les sympt√¥mes ou signes visibles
‚Ä¢ Les risques potentiels identifi√©s
‚Ä¢ Les conditions de d√©couverte
‚Ä¢ Les actions recommand√©es"></textarea>
        <div *ngIf="isFieldInvalid('description')" class="invalid-feedback">
          {{ getFieldErrorMessage('description') }}
        </div>
        <div class="form-text">
          <i class="fas fa-info-circle icon"></i>
          Plus la description est pr√©cise, plus l'intervention sera efficace
        </div>
      </div>
    </div>

    <!-- Classification Section -->
    <div class="form-section">
      <div class="section-title">
        <span class="section-icon">üè∑Ô∏è</span>
        Classification et Priorit√©
      </div>
      <div class="section-description">
        Cat√©gorisez l'anomalie pour une meilleure gestion
      </div>
      
      <div class="row">
        <div class="col-md-6">
          <div class="form-group required">
            <label for="typeAnomalie" class="form-label">
              <span class="label-icon">üîß</span>
              Type d'Anomalie
            </label>
            <select 
              id="typeAnomalie"
              class="form-select"
              [class.is-invalid]="isFieldInvalid('typeAnomalie')"
              [class.is-valid]="signalementForm.get('typeAnomalie')?.valid && signalementForm.get('typeAnomalie')?.touched"
              formControlName="typeAnomalie">
              <option value="" disabled>S√©lectionnez un type</option>
              <option *ngFor="let type of typesAnomalies" [value]="type.value">
                {{ type.label }}
              </option>
            </select>
            <div *ngIf="isFieldInvalid('typeAnomalie')" class="invalid-feedback">
              {{ getFieldErrorMessage('typeAnomalie') }}
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="form-group required">
            <label class="form-label">
              <span class="label-icon">‚ö°</span>
              Niveau de Priorit√©
            </label>
            <div class="priority-grid">
              <div *ngFor="let priorite of priorites" class="priority-option">
                <div class="form-check">
                  <input 
                    class="form-check-input" 
                    type="radio" 
                    [id]="'priorite-' + priorite.value"
                    [value]="priorite.value"
                    formControlName="priorite">
                  <label class="form-check-label" [for]="'priorite-' + priorite.value">
                    <span class="priority-indicator" [style.background-color]="priorite.color"></span>
                    <span class="priority-text">
                      <strong>{{ priorite.label }}</strong>
                    </span>
                  </label>
                </div>
              </div>
            </div>
            <div *ngIf="isFieldInvalid('priorite')" class="invalid-feedback">
              {{ getFieldErrorMessage('priorite') }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Location Section -->
    <div class="form-section">
      <div class="section-title">
        <span class="section-icon">üìç</span>
        Localisation (Optionnel)
      </div>
      <div class="section-description">
        Pr√©cisez la localisation si elle diff√®re de l'actif principal
      </div>
      
      <div class="form-group">
        <label for="localisation" class="form-label">
          <span class="label-icon">üó∫Ô∏è</span>
          Informations de Localisation
        </label>
        <textarea 
          id="localisation"
          class="form-control"
          formControlName="localisation"
          rows="3"
          placeholder="Ex: Quai B, section 3, c√¥t√© tribord
Zone de stockage containers, rang√©e 5
B√¢timent administratif, niveau 2, bureau 205"></textarea>
        <div class="form-text">
          <i class="fas fa-map-marker-alt icon"></i>
          Ajoutez des d√©tails de localisation pour faciliter l'intervention
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="btn-group">
      <button type="submit" class="btn btn-primary" [disabled]="signalementForm.invalid || isSubmitting">
        <i class="fas fa-paper-plane me-2"></i>
        {{ isSubmitting ? '‚è≥ Envoi en cours...' : 'üì§ Signaler l\'Anomalie' }}
      </button>
      <button type="button" class="btn btn-secondary" (click)="onReset()">
        <i class="fas fa-undo me-2"></i>
        R√©initialiser
      </button>
    </div>
  </form>
</div>
