<div class="max-w-4xl mx-auto p-6">
  <!-- Header Section -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">
      <span class="mr-3">{{ isEditMode ? '✏️' : '👤' }}</span>
      {{ isEditMode ? 'Modifier l\'Utilisateur' : 'Créer un Nouvel Utilisateur' }}
    </h1>
    <p class="text-gray-600">
      {{ isEditMode ? 'Mettre à jour les informations utilisateur' : 'Ajouter un nouveau membre à l\'équipe' }}
    </p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-12">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
    <p class="text-gray-600">{{ isEditMode ? 'Chargement des données utilisateur...' : 'Enregistrement en cours...' }}</p>
  </div>

  <!-- Error Alert -->
  <z-card *ngIf="error" zTitle="Erreur" class="mb-6 border-red-200 bg-red-50">
    <div class="text-red-700">
      <span class="mr-2">⚠️</span>
      {{ error }}
    </div>
  </z-card>

  <!-- User Form -->
  <form *ngIf="!loading" (ngSubmit)="onSubmit()" #userForm="ngForm" class="space-y-6" novalidate>

    <!-- Personal Information Section -->
    <z-card zTitle="Informations Personnelles" zDescription="Saisissez les informations de base de l'utilisateur">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
            <span class="mr-2">🏷️</span>
            Nom Complet *
          </label>
          <input
            type="text"
            id="name"
            name="name"
            [(ngModel)]="user.name"
            #name="ngModel"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            [class.ng-invalid]="name.invalid && name.touched"
            [class.ng-valid]="name.valid && name.touched"
            placeholder="Nom complet"
            autocomplete="name"
          />
          <p class="text-xs text-red-500 mt-1" *ngIf="name.invalid && name.touched">
            Le nom complet est obligatoire
          </p>
        </div>

        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
            <span class="mr-2">📧</span>
            Adresse Email *
          </label>
          <input
            type="email"
            id="email"
            name="email"
            [(ngModel)]="user.email"
            #email="ngModel"
            required
            email
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            [class.ng-invalid]="email.invalid && email.touched"
            [class.ng-valid]="email.valid && email.touched"
            placeholder="exemple@societe.com"
            autocomplete="email"
          />
          <p class="text-xs text-red-500 mt-1" *ngIf="email.invalid && email.touched">
            <span *ngIf="email.errors?.['required']">L'adresse email est obligatoire</span>
            <span *ngIf="email.errors?.['email']">Veuillez saisir une adresse email valide</span>
          </p>
        </div>
      </div>
    </z-card>

    <!-- Role and Permissions Section -->
    <z-card zTitle="Rôle et Permissions" zDescription="Définissez le niveau d'accès et les responsabilités de l'utilisateur">
      <div class="space-y-4">
        <div>
          <label for="role" class="block text-sm font-medium text-gray-700 mb-2">
            <span class="mr-2">⚡</span>
            Rôle dans le Système *
          </label>
          <select
            id="role"
            name="role"
            [(ngModel)]="user.role"
            #role="ngModel"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            [class.ng-invalid]="role.invalid && role.touched"
            [class.ng-valid]="role.valid && role.touched"
          >
            <option value="" disabled>Sélectionner un rôle</option>
            <option *ngFor="let role of roles" [value]="role">
              {{ getRoleDisplayName(role) }}
            </option>
          </select>
          <p class="text-xs text-red-500 mt-1" *ngIf="role.invalid && role.touched">
            Veuillez sélectionner un rôle
          </p>
        </div>

        <!-- Role Description -->
        <div *ngIf="user.role" class="p-4 bg-blue-50 border border-blue-200 rounded-md">
          <div class="flex items-start">
            <span class="text-blue-500 mr-2 mt-0.5">ℹ️</span>
            <div>
              <div class="font-medium text-blue-900">{{ getRoleDisplayName(user.role) }}</div>
              <div class="text-sm text-blue-700 mt-1">{{ getRoleDescription(user.role) }}</div>
            </div>
          </div>
        </div>
      </div>
    </z-card>

    <!-- Form Actions -->
    <div class="flex flex-col sm:flex-row justify-end gap-4 pt-6 border-t border-gray-200">
      <button
        type="button"
        (click)="onCancel()"
        class="w-full sm:w-auto order-2 sm:order-1 px-6 py-3 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500 transition-colors duration-200 font-medium"
        [disabled]="loading"
      >
        <span class="mr-2">❌</span>
        Annuler
      </button>
      <button
        type="submit"
        class="w-full sm:w-auto order-1 sm:order-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200 font-medium flex items-center justify-center"
        [disabled]="loading || !user.name.trim() || !user.email.trim() || !user.role"
      >
        <span *ngIf="loading" class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></span>
        <span *ngIf="!isEditMode" class="mr-2">🆕</span>
        <span *ngIf="isEditMode" class="mr-2">💾</span>
        {{ loading ? 'Enregistrement...' : (isEditMode ? 'Mettre à Jour' : 'Créer l\'Utilisateur') }}
      </button>
    </div>
  </form>
</div>
