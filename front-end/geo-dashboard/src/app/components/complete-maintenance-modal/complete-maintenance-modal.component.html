<div class="modal fade show" style="display: block; background: rgba(0,0,0,0.5);" *ngIf="maintenance" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          {{ maintenance?.statut === 'terminee' ? 'ğŸ“‹ RÃ©viser et Exporter le Rapport - ' : 'âœ… Terminer la Maintenance - ' }}{{ maintenance?.titre }}
        </h5>
        <button type="button" class="btn-close" (click)="close.emit()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="completionForm" (ngSubmit)="onSubmit()">
          
          <!-- Dates Section -->
          <div class="form-section dates-section">
            <div class="section-title">
              <span class="section-icon">ğŸ•’</span>
              Dates d'ExÃ©cution
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="dateDebut" class="form-label">Date de DÃ©but RÃ©elle <span class="text-danger">*</span></label>
                  <input type="datetime-local" id="dateDebut" formControlName="dateDebut" class="form-control">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="dateFin" class="form-label">Date de Fin RÃ©elle <span class="text-danger">*</span></label>
                  <input type="datetime-local" id="dateFin" formControlName="dateFin" class="form-control">
                </div>
              </div>
            </div>
          </div>

          <!-- Cost Comparison Section -->
          <div class="form-section cost-comparison">
            <div class="section-title">
              <span class="section-icon">ğŸ’°</span>
              Analyse des CoÃ»ts
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="coutEstime" class="form-label">CoÃ»t EstimÃ© (MAD)</label>
                  <input type="number" id="coutEstime" [value]="maintenance?.coutEstime || 0" class="form-control" readonly>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="coutReel" class="form-label">CoÃ»t RÃ©el (MAD) <span class="text-danger">*</span></label>
                  <input type="number" id="coutReel" formControlName="coutReel" class="form-control" step="0.01" min="0">
                </div>
              </div>
            </div>
            
            <!-- External Company -->
            <div class="mb-0">
              <label for="entrepriseExterne" class="form-label">SociÃ©tÃ© Externe</label>
              <input type="text" id="entrepriseExterne" formControlName="entrepriseExterne" class="form-control" 
                     placeholder="Nom de la sociÃ©tÃ© externe (si applicable)">
            </div>
          </div>

          <!-- Execution Details Section -->
          <div class="form-section details-section">
            <div class="section-title">
              <span class="section-icon">ğŸ“</span>
              DÃ©tails d'Intervention
            </div>
            
            <!-- Intervention Report -->
            <div class="mb-3">
              <label for="rapportIntervention" class="form-label">Rapport d'Intervention <span class="text-danger">*</span></label>
              <textarea id="rapportIntervention" formControlName="rapportIntervention" class="form-control" rows="4" 
                        placeholder="DÃ©crivez les travaux effectuÃ©s, les problÃ¨mes rencontrÃ©s, et les solutions appliquÃ©es..."></textarea>
            </div>

            <!-- Replaced Parts -->
            <div class="mb-3">
              <label for="piecesRemplacees" class="form-label">PiÃ¨ces RemplacÃ©es</label>
              <textarea id="piecesRemplacees" formControlName="piecesRemplacees" class="form-control" rows="3" 
                        placeholder="Liste des piÃ¨ces remplacÃ©es avec rÃ©fÃ©rences et quantitÃ©s..."></textarea>
            </div>

            <!-- Document Annexe -->
            <div class="mb-0">
              <label for="documentAnnexe" class="form-label">Documents Annexes</label>
              <textarea id="documentAnnexe" formControlName="documentAnnexe" class="form-control" rows="2" 
                        placeholder="RÃ©fÃ©rences des documents, photos, ou certificats joints..."></textarea>
            </div>
          </div>

          <!-- Anomaly Resolution Section -->
          <div *ngIf="maintenance?.anomalieId" class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="resolveLinkedAnomaly" formControlName="resolveLinkedAnomaly">
            <label class="form-check-label" for="resolveLinkedAnomaly">
              <strong>Marquer l'anomalie liÃ©e comme rÃ©solue</strong><br>
              <small>Cette action fermera automatiquement l'anomalie associÃ©e Ã  cette maintenance</small>
            </label>
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="close.emit()">Annuler</button>
        <button type="button" class="btn btn-primary" (click)="onSubmit()" [disabled]="completionForm.invalid || isSubmitting">
          {{ isSubmitting ? 'â³ Traitement...' : (maintenance?.statut === 'terminee' ? 'ğŸ“‹ Mettre Ã  Jour et Exporter' : 'âœ… Terminer la Maintenance') }}
        </button>
      </div>
    </div>
  </div>
</div>
