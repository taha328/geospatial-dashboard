<div class="actif-form-container">
  <div class="form-header">
    <h2>{{ editMode ? 'Modifier' : 'Créer' }} un actif</h2>
    <button type="button" class="btn-close" (click)="cancel.emit()">×</button>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <form [formGroup]="actifForm" (ngSubmit)="onSubmit()">
    <!-- Hiérarchie - Portefeuille, Famille, Groupe -->
    <div class="hierarchy-section">
      <h3>Hiérarchie</h3>
      
      <div class="form-group">
        <label for="portefeuille">Portefeuille</label>
        <select id="portefeuille" formControlName="portefeuilleId" class="form-control" (change)="onPortefeuilleChange()">
          <option value="">Sélectionner un portefeuille</option>
          <option *ngFor="let p of portefeuilles" [value]="p.id">{{ p.nom }}</option>
        </select>
        <div *ngIf="actifForm.get('portefeuilleId')?.invalid && actifForm.get('portefeuilleId')?.touched" class="error-message">
          Portefeuille requis
        </div>
      </div>
      
      <div class="form-group">
        <label for="famille">Famille d'actifs</label>
        <select id="famille" formControlName="familleActifId" class="form-control" [disabled]="!familles.length" (change)="onFamilleChange()">
          <option value="">Sélectionner une famille</option>
          <option *ngFor="let f of familles" [value]="f.id">{{ f.nom }}</option>
        </select>
        <div *ngIf="actifForm.get('familleActifId')?.invalid && actifForm.get('familleActifId')?.touched" class="error-message">
          Famille requise
        </div>
      </div>
      
      <div class="form-group">
        <label for="groupe">Groupe d'actifs</label>
        <select id="groupe" formControlName="groupeActifId" class="form-control" [disabled]="!groupes.length">
          <option value="">Sélectionner un groupe</option>
          <option *ngFor="let g of groupes" [value]="g.id">{{ g.nom }}</option>
        </select>
        <div *ngIf="actifForm.get('groupeActifId')?.invalid && actifForm.get('groupeActifId')?.touched" class="error-message">
          Groupe requis
        </div>
      </div>
    </div>
    
    <!-- Informations de base -->
    <div class="basic-info-section">
      <h3>Informations de base</h3>
      
      <div class="form-group">
        <label for="nom">Nom de l'actif</label>
        <input id="nom" type="text" formControlName="nom" class="form-control">
        <div *ngIf="actifForm.get('nom')?.invalid && actifForm.get('nom')?.touched" class="error-message">
          Nom requis
        </div>
      </div>
      
      <div class="form-group">
        <label for="type">Type d'actif</label>
        <select id="type" formControlName="type" class="form-control">
          <option value="">Sélectionner un type</option>
          <option value="bollard">Bollard</option>
          <option value="defense">Défense</option>
          <option value="quai">Quai</option>
          <option value="grue">Grue</option>
          <option value="entrepot">Entrepôt</option>
          <option value="eclairage">Éclairage</option>
          <option value="vehicule">Véhicule</option>
          <option value="autre">Autre</option>
        </select>
        <div *ngIf="actifForm.get('type')?.invalid && actifForm.get('type')?.touched" class="error-message">
          Type requis
        </div>
      </div>
      
      <div class="form-group">
      </div>
    </div>
    
    <!-- État et statut -->
    <div class="status-section">
      <h3>État et statut</h3>
      
      <div class="form-group">
        <label for="statutOperationnel">Statut opérationnel</label>
        <select id="statutOperationnel" formControlName="statutOperationnel" class="form-control">
          <option value="operationnel">Opérationnel</option>
          <option value="maintenance">En maintenance</option>
          <option value="hors_service">Hors service</option>
          <option value="alerte">En alerte</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="etatGeneral">État général</label>
        <select id="etatGeneral" formControlName="etatGeneral" class="form-control">
          <option value="bon">Bon</option>
          <option value="moyen">Moyen</option>
          <option value="mauvais">Mauvais</option>
          <option value="critique">Critique</option>
        </select>
      </div>
    </div>
    
    <!-- Localisation -->
    <div class="location-section">
      <h3>Localisation</h3>
      
      <div class="form-row">
        <div class="form-group">
          <label for="latitude">Latitude</label>
          <input id="latitude" type="number" formControlName="latitude" class="form-control" [readonly]="true">
        </div>
        
        <div class="form-group">
          <label for="longitude">Longitude</label>
          <input id="longitude" type="number" formControlName="longitude" class="form-control" [readonly]="true">
        </div>
      </div>
    </div>
    
    <!-- Informations additionnelles -->
    <div class="additional-info-section">
      <h3>Informations additionnelles</h3>
      
      <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" formControlName="description" class="form-control" rows="3"></textarea>
      </div>
      
      <div class="form-group">
        <label for="dateMiseEnService">Date de mise en service</label>
        <input id="dateMiseEnService" type="date" formControlName="dateMiseEnService" class="form-control">
      </div>
      
      <div class="form-group">
        <label for="dateFinGarantie">Date de fin de garantie</label>
        <input id="dateFinGarantie" type="date" formControlName="dateFinGarantie" class="form-control">
      </div>
      
      <div class="form-group">
        <label for="fournisseur">Fournisseur</label>
        <input id="fournisseur" type="text" formControlName="fournisseur" class="form-control">
      </div>
      
      <div class="form-group">
        <label for="valeurAcquisition">Valeur d'acquisition (MAD)</label>
        <input id="valeurAcquisition" type="number" formControlName="valeurAcquisition" class="form-control">
      </div>
    </div>
    
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="cancel.emit()">Annuler</button>
      <button type="submit" class="btn btn-primary" [disabled]="actifForm.invalid || isSubmitting">
        {{ editMode ? 'Mettre à jour' : 'Créer' }}
      </button>
    </div>
  </form>
</div>
